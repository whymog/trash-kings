function shuffle(e){for(var t,a,n=e.length;n;)a=Math.floor(Math.random()*n--),t=e[n],e[n]=e[a],e[a]=t;return e}var allocate=function(e){var t=e.target.dataset.assignment,a=e.target.classList[0];if("decrementAssignees"===a){if(getAssignments(t).length<1){var n=new Message({message:"Unable to decrement - no raccoons currently assigned"});return n}for(var s=0;s<raccoons.length;s++)if(raccoons[s].assignment===t)return raccoons[s].assignment="unassigned",void updateAllocationLabels(t)}else if("incrementAssignees"===a){if(getAssignments("unassigned").length<=getChildRaccoons().length){var n=new Message({message:"Unable to allocate - all racccoons are currently assigned"});return n}for(var s=0;s<raccoons.length;s++)if("unassigned"===raccoons[s].assignment&&getAge(raccoons[s])>new Date("January 1, 1971"))return raccoons[s].assignment=t,void updateAllocationLabels(t)}console.log(e),console.log(e.target.dataset.assignment),console.log(e.target.classList[0])},updateAllocationLabels=function(e){"unassigned"!==e&&$("span[data-assignment="+e+"]").html(getAssignments(e).length),$(".numUnassigned").html(getAssignments("unassigned").length+" raccoons are unassigned")},getAge=function(e){return Math.abs(date-e.birthday)},getTotalRaccoons=function(){return raccoons.length},getAdultRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)getAge(raccoons[t])>=new Date("January 1, 1971")&&e.push(raccoons[t]);return e},getChildRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)getAge(raccoons[t])<new Date("January 1, 1971")&&e.push(raccoons[t]);return e},getMaleRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)"male"===raccoons[t].sex&&e.push(raccoons[t]);return e},getFemaleRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)"female"===raccoons[t].sex&&e.push(raccoons[t]);return e},getAdultMaleRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)"male"===raccoons[t].sex&&getAge(raccoons[t])>=new Date("January 1, 1971")&&e.push(raccoons[t]);return e},getAdultFemaleRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)"female"===raccoons[t].sex&&getAge(raccoons[t])>=new Date("January 1, 1971")&&e.push(raccoons[t]);return e},getChildMaleRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)"male"===raccoons[t].sex&&getAge(raccoons[t])<new Date("January 1, 1971")&&e.push(raccoons[t]);return e},getChildFemaleRaccoons=function(){for(var e=[],t=0;t<raccoons.length;t++)"female"===raccoons[t].sex&&getAge(raccoons[t])<new Date("January 1, 1971")&&e.push(raccoons[t]);return e},assignName=function(e){var t=Math.random()<.33?"neutral":e;return RaccoonNames[t][Math.floor(Math.random()*RaccoonNames[t].length)]},getAssignments=function(e){if(e){for(var t=[],a=0;a<raccoons.length;a++)raccoons[a].assignment===e&&t.push(raccoons[a]);return t}for(var n=["unassigned","gatherTwigs","gatherFood"],s={},a=0;a<n.length;a++){for(var o=n[a],r=0,c=0;c<raccoons.length;c++)raccoons[c].assignment===n[a]&&r++;s[o]=r}return s},getHoursMinutesString=function(e){var t=e.getHours()+":";return t+=(e.getMinutes()<10?"0":"")+e.getMinutes()+" ",t+=e.getHours()<12?"a.m.":"p.m."},getMonthName=function(e){return monthNames[e]},getSeason=function(e){return 11===e.getMonth()&&e.getDate()>=21||e.getMonth()<2||2===e.getMonth()&&e.getDate()<=19?"Winter":2===e.getMonth()&&e.getDate()>=20||e.getMonth()>2&&e.getMonth()<6||5===e.getMonth()&&e.getDate()<=20?"Spring":5===e.getMonth()&&e.getDate()>=21||e.getMonth()>5&&e.getMonth()<8||8===e.getMonth()&&e.getDate()<=21?"Summer":"Fall"},getRateOfChangeFood=function(){var e=Number(foodGatherRate*minutesPerTick*getAssignments("gatherFood").length),t=Number(foodGatherRate/10*minutesPerTick*getTotalRaccoons()),a="";return e>t&&(a+="+"),a+=(e-t).toFixed(2).toString()},getRateOfChangeTwigs=function(){var e=Number(twigsGatherRate*minutesPerTick*getAssignments("gatherTwigs").length);console.log("twigsIncreaseRate",e);var t="";return e>0&&(t+="+"),t+=e.toFixed(2).toString()},breedRaccoons=function(){if(bredThisYear)return void console.log("Can't breed â€” already bred this year!");if(currentlyBreeding)return void console.log("Breeding already in progress.");bredThisYear=!0;var e=getAdultFemaleRaccoons(),t=(getAdultMaleRaccoons(),getAdultFemaleRaccoons().length>getAdultMaleRaccoons().length?getAdultMaleRaccoons().length:getAdultFemaleRaccoons().length);if(console.log("Breeding pairs:",t,"Males:",getAdultMaleRaccoons().length,"Females:",getAdultFemaleRaccoons().length),t===e.length)for(var a=0;a<raccoons.length;a++)"female"===raccoons[a].sex&&getAge(raccoons[a])>=365&&(raccoons[a].pregnant=!0);else{for(var n=[],a=0;a<raccoons.length;a++)"female"===raccoons[a].sex&&getAge(raccoons[a])>=365&&n.push(a);console.log(n),shuffle(n),console.log(n);for(var a=0;a<t;a++)raccoons[n[a]].pregnant=!0;console.log(raccoons)}currentlyBreeding=!0;var s=new ProgressBar("breedBar",89280);new Message({message:"Raccoons have bred. Now...we wait."});s.addToDOM()},spawnBabyRaccoons=function(){for(var e=getAdultFemaleRaccoons(),t=0,a=[],n=0;n<e.length;n++){var s=e[n].id;raccoons[s].alive&&raccoons[s].pregnant&&(t++,raccoons[s].pregnant=!1)}console.log(t);for(var n=0;n<t;n++)for(var o=Math.floor(7*Math.random()+1),r=0;r<o;r++){var c=raccoons.length,i={id:c,sex:Math.random()>.5?"female":"male",birthday:date,pregnant:!1,assignment:"unassigned",alive:!0};i.name=assignName(i.sex),console.log(i),a.push(i),raccoons.push(i),console.log(i)}for(var g=[],n=0;n<a.length;n++)g.push({name:a[n].name,sex:a[n].sex});new Message({message:"<span class='messageTooltip'>"+a.length+"</span> babies were born!",tooltip:g});$("#breedBar .progressBar").fadeOut(5e3,function(){$("#breedBar .progressBar").remove()})},tickRate=500,minutesPerTick=60,humans=3189e5,sizeOfUnitedStates=3537436,raccoonTerritory=1,humanTerritory=sizeOfUnitedStates-raccoonTerritory,foodStores=10,twigStores=0,foodGatherRate=.001,twigsGatherRate=.001,humanGrowthRate=5,startingDate=new Date("December 20, 2017 6:00:00"),date=startingDate,currentSeason,bredThisYear=!1,currentlyBreeding=!1,breedTimeRequired=86400,breedTimeElapsed=0,$statsPane,$actionsPane,monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],seasons={winter:{name:"Winter",start:new Date("December 21"),end:new Date("March 19")},spring:{name:"Spring",start:new Date("March 20"),end:new Date("June 20")},summer:{name:"Summer",start:new Date("June 21"),end:new Date("September 21")},fall:{name:"Fall",start:new Date("September 22"),end:new Date("December 20")}},Message=function(e){if(this.object=e,this.date=date,console.log(this.object),this.object.message){var t="<div class='messageContainer'><span class='messageText'>"+this.object.message+"</span>";if(t+="<div class='messageTimestamp'>("+this.date.toDateString()+" "+getHoursMinutesString(this.date)+")</div><br />",t+="</div>",this.object.tooltip){t+="<div class='tooltipOverlay'>";for(var a=0;a<this.object.tooltip.length;a++){for(var n in this.object.tooltip[a])t+=this.object.tooltip[a][n]+" ";t+="<br />"}t+="</div>"}$("#messageWindow").prepend(t)}},ProgressBar=function(e,t){this.id=e,this.limit=t,this.ticksElapsed=0,this.ticksToLimit=t/minutesPerTick,this.fadeTimer=500,console.log(this.id,this.limit),this.HTML="<div class='progressBar "+this.id+"'><div class='fill'></div><div class='text'></div></div>"};ProgressBar.prototype.addToDOM=function(){var e=this.id,t=this.HTML;$("#"+e).html(t)};var updateProgressBars=function(){if(currentlyBreeding)if(breedTimeElapsed<breedTimeRequired){console.log(breedTimeElapsed,minutesPerTick),breedTimeElapsed+=minutesPerTick,$("div.breedBar .fill").css("width",breedTimeElapsed/breedTimeRequired*300);var e=breedTimeRequired-breedTimeElapsed,t="minutes";e>1440?(e=Math.floor(e/1440),t="days"):e>60&&(e=Math.floor(e/60),t="hours"),$("div.breedBar .text").html(e+" "+t+" left")}else breedTimeElapsed>=breedTimeRequired&&($("div.breedBar .text").html("DONE!"),currentlyBreeding=!1,spawnBabyRaccoons(),breedTimeElapsed=0)},RaccoonNames={male:["Bilbo","Jim-Bob","Reginald Raccoon-VelJohnson","Dudeface McBroson",'Steve "Raccoon" Buscemi',"Norbert"],female:["Racchel","Araccoon Martell","Gladys","Elizabeth","Josephine","Neoprene","Polyethylene"],neutral:["Raccquetball","The shifty-eyed one","The one who keeps stealing the cat's food","The Notorious R.A.C.C.O.O.N.","Rocky","Trashfiend"],titles:["the Enlightened","the Stinky","of the Sacred Detritus","the Discarded"]},raccoons=[{id:0,name:"Raccoon1",sex:"male",birthday:new Date("December 19, 2016 6:00:00"),pregnant:!1,assignment:"unassigned",alive:!0},{id:1,name:"Raccoon2",sex:"female",birthday:new Date("December 19, 2016 6:00:00"),pregnant:!1,assignment:"unassigned",alive:!0},{id:2,name:"Raccoon3",sex:"male",birthday:new Date("December 19, 2016 6:00:00"),pregnant:!1,assignment:"unassigned",alive:!0},{id:3,name:"Raccoon4",sex:"female",birthday:new Date("December 19, 2016 6:00:00"),pregnant:!1,assignment:"unassigned",alive:!0},{id:4,name:"Raccoon5",sex:"female",birthday:new Date("December 19, 2016 6:00:00"),pregnant:!1,assignment:"unassigned",alive:!0}],startGame=function(){defineUIElements(),prepUI(),updateStatsPane(),updateActionsPane(),tick()},defineUIElements=function(){$statsPane=$(".statsOutput"),$statNumRaccoons=$(".numRaccoons .stat"),$expandedNumRaccoons=$(".numRaccoons .expandedStat"),$statNumHumans=$(".numHumans .stat"),$statSeason=$(".season .stat"),$statDate=$(".date .stat"),$statTime=$(".time .stat"),$statFood=$(".food .stat"),$statTwigs=$(".twigs .stat"),$assignmentsPane=$(".assignments"),$actionsPane=$(".actions"),console.log($actionsPane)},prepUI=function(){$("div.progressBar").hide(),$("input.speedControl").val(minutesPerTick),$("span.speedControl.display").html(minutesPerTick+" minutes per tick"),$(".numUnassigned").html(updateAllocationLabels("unassigned"))},updateStatsPane=function(){$statNumRaccoons.html(getTotalRaccoons()),$expandedNumRaccoons.html("Adults: "+getAdultRaccoons().length+" ("+getAdultFemaleRaccoons().length+" females, "+getAdultMaleRaccoons().length+" males)<br />Children: "+getChildRaccoons().length+" ("+getChildFemaleRaccoons().length+" females, "+getChildMaleRaccoons().length+" males)<br />"),$statNumHumans.html(humans),$statSeason.html(getSeason(date)),$statDate.html(getHoursMinutesString(date)),$statTime.html(getMonthName(date.getMonth())+"  "+date.getDate()+", "+date.getFullYear()),$statFood.html(foodStores.toFixed(1)+" | "+getRateOfChangeFood()+"/tick"),$statTwigs.html(twigStores.toFixed(1)+" | "+getRateOfChangeTwigs()+"/tick")},updateActionsPane=function(){"Winter"!==currentSeason||bredThisYear?$("#breedBtn").prop("disabled",!0):foodStores>=2*getAdultRaccoons().length&&$("#breedBtn").prop("disabled",!1)},updateDate=function(){var e=getSeason(date);date=new Date(date.getTime()+6e4*minutesPerTick),currentSeason=getSeason(date),e!==currentSeason&&checkSeasonChangeEvents(currentSeason)},updateHumanPopulation=function(){humans+=humanGrowthRate*minutesPerTick},updateStores=function(){getAssignments();getAssignments("gatherFood").length>0&&(foodStores+=foodGatherRate*minutesPerTick*getAssignments("gatherFood").length),getAssignments("gatherTwigs").length>0&&(twigStores+=twigsGatherRate*minutesPerTick*getAssignments("gatherTwigs").length),foodStores-=1e-4*minutesPerTick*getTotalRaccoons()},checkSeasonChangeEvents=function(e){new Message({message:"It is now "+e+"."});"Winter"===e&&(bredThisYear=!1)},tick=function(){window.setTimeout(function(){updateDate(),updateHumanPopulation(),updateStores(),updateStatsPane(),updateActionsPane(),updateProgressBars(),tick()},tickRate)};$(document).ready(function(){$("#breedBtn").click(function(){breedRaccoons()}),$(".statExpander").click(function(e){"[v]"===$(e.target).html()?$(e.target).html("[^]"):$(e.target).html("[v]");var t=$(e.target).data("stat"),a=$(".expandedStat[data-stat="+t+"]");$(a).toggle()}),$("input.speedControl").change(function(){minutesPerTick=Number($(".speedControl").val()),$("span.speedControl.display").html(minutesPerTick+" minutes per tick")}),$("div.assignments button").on("click",function(e){allocate(e)}),startGame()});